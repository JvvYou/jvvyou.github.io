
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="istio 安全 身份验证策略">
      
      
      
        <link rel="canonical" href="https://jvvyou.github.io/native/istio-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/">
      
      
        <link rel="prev" href="../istio-%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%BD%E8%B8%AA/">
      
      
      
      <link rel="icon" href="../../assets/img/person/index_logo.jpeg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>istio 安全 身份验证策略 - vv的小站</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VGR40J3Y3P"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VGR40J3Y3P",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VGR40J3Y3P",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="istio 安全 身份验证策略 - vv的小站" >
      
        <meta  property="og:description"  content="istio 安全 身份验证策略" >
      
        <meta  property="og:image"  content="https://jvvyou.github.io/assets/images/social/native/istio-身份验证.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://jvvyou.github.io/native/istio-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="istio 安全 身份验证策略 - vv的小站" >
      
        <meta  name="twitter:description"  content="istio 安全 身份验证策略" >
      
        <meta  name="twitter:image"  content="https://jvvyou.github.io/assets/images/social/native/istio-身份验证.png" >
      
    
    
  <!-- Add scripts that need to run before here -->
  
  <!-- Add scripts that need to run afterwards here -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6676480188236347"
     crossorigin="anonymous"></script>

   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="vv的小站" class="md-header__button md-logo" aria-label="vv的小站" data-md-component="logo">
      
  <img src="../../assets/img/person/index_logo.jpeg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            vv的小站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              istio 安全 身份验证策略
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
    
  
  首页

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../language/%E6%B5%81%E7%95%85%E7%9A%84python%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
    
  
  语言

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../istio%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86-vs/" class="md-tabs__link">
          
  
    
  
  云原生

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="vv的小站" class="md-nav__button md-logo" aria-label="vv的小站" data-md-component="logo">
      
  <img src="../../assets/img/person/index_logo.jpeg" alt="logo">

    </a>
    vv的小站
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    首页
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            首页
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    博客
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            博客
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    归档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    分类
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    devops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k8s
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/life/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    life
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    monitor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/sys/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sys
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    语言
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            语言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/%E6%B5%81%E7%95%85%E7%9A%84python%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    流畅的python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    云原生
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            云原生
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86-vs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    istio VirtualService 配置示例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86-dr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    istio DestinationRule
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio-gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    istio gateway 试玩
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio-envoy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    istio envoy 访问外部服务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio-%E5%AE%89%E5%85%A8%E6%8E%88%E6%9D%83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    istio 安全 授权
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio-%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%BD%E8%B8%AA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    istio 分布式追踪
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    istio 安全 身份验证策略
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    istio 安全 身份验证策略
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1、两种身份验证方式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1、两种身份验证方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1、对等身份验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2、请求身份验证
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2tls" class="md-nav__link">
    <span class="md-ellipsis">
      2、互相tls认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2、互相tls认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1、宽容模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2、安全命名
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3、身份验证策略
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3、身份验证策略">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1、策略存储
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2、选择器字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3、对等身份验证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3、对等身份验证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" class="md-nav__link">
    <span class="md-ellipsis">
      3.3.1、官网例子
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4、请求身份验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35principal" class="md-nav__link">
    <span class="md-ellipsis">
      3.5、principal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6、对等身份验证策略测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.6、对等身份验证策略测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#361" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.1、基础配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#362" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.2、宽容模式测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#363" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.3、严格模式测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#364" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.4、策略优先级
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    <span class="md-ellipsis">
      3.7、请求身份验证测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.7、请求身份验证测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#371" class="md-nav__link">
    <span class="md-ellipsis">
      3.7.1、配置策略
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#372" class="md-nav__link">
    <span class="md-ellipsis">
      3.7.2、官方示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1、两种身份验证方式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1、两种身份验证方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1、对等身份验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2、请求身份验证
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2tls" class="md-nav__link">
    <span class="md-ellipsis">
      2、互相tls认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2、互相tls认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1、宽容模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2、安全命名
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3、身份验证策略
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3、身份验证策略">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1、策略存储
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2、选择器字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3、对等身份验证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3、对等身份验证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" class="md-nav__link">
    <span class="md-ellipsis">
      3.3.1、官网例子
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4、请求身份验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35principal" class="md-nav__link">
    <span class="md-ellipsis">
      3.5、principal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6、对等身份验证策略测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.6、对等身份验证策略测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#361" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.1、基础配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#362" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.2、宽容模式测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#363" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.3、严格模式测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#364" class="md-nav__link">
    <span class="md-ellipsis">
      3.6.4、策略优先级
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    <span class="md-ellipsis">
      3.7、请求身份验证测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.7、请求身份验证测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#371" class="md-nav__link">
    <span class="md-ellipsis">
      3.7.1、配置策略
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#372" class="md-nav__link">
    <span class="md-ellipsis">
      3.7.2、官方示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  <!--
Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to
deal in the Software without restriction, including without limitation the
rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
IN THE SOFTWARE.
-->

<!-- Tags -->


<nav class="md-tags" >
  
    
    
    
      <span class="md-tag">istio</span>
    
  
    
    
    
      <span class="md-tag">k8s</span>
    
  
</nav>


<!-- Actions -->


<!--
Hack: check whether the content contains a h1 headline. If it doesn't, the
page title (or respectively site name) is used as the main headline.
-->

<h1>istio 安全 身份验证策略</h1>


<!-- Page content -->
<p>&ensp;&ensp;对等身份验证和请求身份验证</p>
<!-- more -->

<h2 id="1">1、两种身份验证方式</h2>
<h3 id="11">1.1、对等身份验证</h3>
<p>用于服务到服务身份验证，以验证建立连接的客户端。Istio 提供双向 TLS作为传输身份验证的全栈解决方案，无需更改服务代码即可启用。</p>
<h3 id="12">1.2、请求身份验证</h3>
<p>用于最终用户身份验证，以验证附加到请求的凭据。Istio 使用 JSON Web Token (JWT) 验证实现请求级身份验证，并使用自定义身份验证提供程序或任何 OpenID Connect 提供程序简化开发人员体验。</p>
<h2 id="2tls">2、互相tls认证</h2>
<p>istio使用envoy代理作为客户端和服务端的pep(策略执行点)，在服务之间创建了一种安全的隧道化通信机制。当一个负载向另一个负载通过互相tls认证发起请求时，请求会有如下处理方式：</p>
<ul>
<li>
<p>Istio 将客户端的出站流量重新路由到客户端本地的 sidecar Envoy。</p>
</li>
<li>
<p>客户端 Envoy 开始与服务器端 Envoy 进行双向 TLS 握手。在握手过程中，客户端 Envoy 还会进行 安全命名 检查，以验证服务器证书中提供的服务帐户是否有权运行目标服务。</p>
</li>
<li>
<p>客户端 Envoy 和服务端 Envoy 建立相互 TLS 连接，Istio 将流量从客户端 Envoy 转发到服务端 Envoy。</p>
</li>
<li>
<p>服务端 Envoy 授权请求。如果获得授权，它会通过本地 TCP 连接将流量转发到后端服务。</p>
</li>
</ul>
<h3 id="21">2.1、宽容模式</h3>
<p>Istio 双向 TLS 具有宽容模式，允许服务同时接受纯文本流量和双向 TLS 流量。</p>
<h3 id="22">2.2、安全命名</h3>
<p>服务器身份编码在证书中，但服务名称通过发现服务或DNS检索。安全命名信息将服务器身份映射到服务名称。身份A到服务名称B的映射意味着“A被授权运行服务B”。控制平面监视apiserver，生成安全命名映射，并将它们安全地分发给PEP。</p>
<p>请注意，对于非 HTTP/HTTPS 流量，安全命名无法防止 DNS 欺骗，在这种情况下，攻击者会修改服务的目标 IP。由于 TCP 流量不包含Host信息，并且 Envoy 只能依赖目标 IP 进行路由，因此 Envoy 可能会将流量路由到被劫持 IP 上的服务。这种 DNS 欺骗甚至可能在客户端 Envoy 收到流量之前就发生了。</p>
<h2 id="3">3、身份验证策略</h2>
<h3 id="31">3.1、策略存储</h3>
<p>Istio 将网格范围策略存储在 <mark>根命名空间</mark> 中。这些策略具有一个空的选择器，适用于网格中的所有工作负载。具有命名空间范围的策略存储在相应的命名空间中。它们仅适用于其命名空间内的工作负载。如果您配置字段selector，则身份验证策略仅适用于符合您配置的条件的工作负载。</p>
<p>对等身份验证策略：PeerAuthentication</p>
<p>请求身份验证策略：RequestAuthentication</p>
<h3 id="32">3.2、选择器字段</h3>
<p>对等身份验证策略 和 请求身份验证策略 使用selector字段来指定要应用该策略的工作负载的标签。</p>
<p>如果您不为该字段提供值selector，Istio 会将策略与策略存储范围内的所有工作负载进行匹配。</p>
<p>selector字段可帮助指定策略的范围：</p>
<ul>
<li>
<p>网格范围策略：为根命名空间指定的策略，没有或带有空selector字段。</p>
</li>
<li>
<p>命名空间范围的策略：为没有或带有空选择器字段的非根名称空间指定的策略。</p>
</li>
<li>
<p>工作负载特定策略：在常规命名空间中定义的策略，具有非空的选择器字段。</p>
</li>
</ul>
<p>每个命名空间只能有一个网格范围的 <mark>对等身份验证策略</mark> ，并且每个命名空间只能有一个命名空间范围的 <mark>对等身份验证策略</mark> 。当您为同一个网格或命名空间配置多个网格范围或命名空间范围的 <mark>对等身份验证策略</mark> 时，Istio 会 <mark>忽略较新的策略</mark> 。当有多个特定于工作负载的对等身份验证策略匹配时，Istio 会 <mark>选择最旧的策略</mark> 。</p>
<p>工作复制最窄匹配策略：</p>
<ol>
<li>
<p>特定于工作负载</p>
</li>
<li>
<p>命名空间范围</p>
</li>
<li>
<p>网格范围</p>
</li>
</ol>
<p>Istio 可以组合所有匹配的 <mark>请求身份验证策略</mark> ，就像它们来自单个请求身份验证策略一样。因此，您可以在网格或命名空间中拥有多个网格范围或命名空间范围的策略。但是，<mark>避免</mark> 拥有多个网格范围或命名空间范围的请求身份验证策略仍然是一种很好的做法。</p>
<h3 id="33">3.3、对等身份验证</h3>
<p>对等身份验证策略指定 Istio 在目标工作负载上强制实施的双向 TLS 模式。支持以下模式：</p>
<ul>
<li>
<p>PERMISSIVE：工作负载接受相互的TLS和纯文本流量。当没有sidecar的工作负载无法使用互TLS时，此模式在迁移期间最有用。一旦使用sidecar注入迁移了工作负载，就应该将模式切换为STRICT。</p>
</li>
<li>
<p>STRICT：工作负载只接受相互的TLS流量。</p>
</li>
<li>
<p>DISABLE：禁用互TLS。从安全角度来看，除非您提供自己的安全解决方案，否则不应该使用此模式。</p>
</li>
</ul>
<p>当模式未设置时，将继承父范围的模式。未设置模式的网格范围对等身份验证策略默认使用PERMISSIVE模式。</p>
<h4 id="331">3.3.1、官网例子</h4>
<p>以下对等身份验证策略要求命名空间foo中的所有工作负载使用相互TLS：
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security.istio.io/v1</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PeerAuthentication</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;example-policy&quot;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;foo&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">mtls</span><span class="p">:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STRICT</span>
</span></code></pre></div>
以下示例禁用 <mark>工作负载</mark> 80端口上的双向TLS,并对所有其他端口使用命名空间范围的对等身份验证策略的双向 TLS 设置：
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security.istio.io/v1</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PeerAuthentication</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;example-workload-policy&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;foo&quot;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">     </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">       </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-app</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="nt">portLevelMtls</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="nt">80</span><span class="p">:</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DISABLE</span>
</span></code></pre></div></p>
<h3 id="34">3.4、请求身份验证</h3>
<p>请求身份验证策略指定验证 JSON Web Token (JWT) 所需的值。</p>
<h3 id="35principal">3.5、principal</h3>
<p>当您使用对等身份验证策略和相互TLS时，Istio将从对等身份验证中提取身份到source.principal中。类似地，当您使用请求身份验证策略时，Istio将JWT中的标识分配给request.auth.principal。使用这些主体设置授权策略和作为遥测输出。</p>
<h3 id="36">3.6、对等身份验证策略测试</h3>
<h4 id="361">3.6.1、基础配置</h4>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>bar<span class="w"> </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>foo<span class="w"> </span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>legacy
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>kubectl<span class="w"> </span>label<span class="w"> </span>namespace<span class="w"> </span>foo<span class="w"> </span>istio-injection<span class="o">=</span>enabled
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>kubectl<span class="w"> </span>label<span class="w"> </span>namespace<span class="w"> </span>bar<span class="w"> </span>istio-injection<span class="o">=</span>enabled
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>samples/sleep/sleep.yaml<span class="w"> </span>-n<span class="w"> </span>bar
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>samples/sleep/sleep.yaml<span class="w"> </span>-n<span class="w"> </span>foo
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>samples/sleep/sleep.yaml<span class="w"> </span>-n<span class="w"> </span>legacy
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c1"># 可以参考前面几篇文章的，都是一样的。</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>service-a.yml<span class="w"> </span>-n<span class="w"> </span>bar
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>service-a.yml<span class="w"> </span>-n<span class="w"> </span>foo
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>service-a.yml<span class="w"> </span>-n<span class="w"> </span>legacy
</span></code></pre></div>
<p>此时是接受相互的TLS和纯文本流量。
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">for</span><span class="w"> </span>from<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="s2">&quot;legacy&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>to<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="w"> </span><span class="s2">&quot;legacy&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">        </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sleep<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">from</span><span class="si">}</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">={</span>.items..metadata.name<span class="o">}</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-c<span class="w"> </span>sleep<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">from</span><span class="si">}</span><span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;http://service-a.</span><span class="si">${</span><span class="nv">to</span><span class="si">}</span><span class="s2">:8000/api/v1/testA/get_headers/&quot;</span><span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;sleep.</span><span class="si">${</span><span class="nv">from</span><span class="si">}</span><span class="s2"> to service-a.</span><span class="si">${</span><span class="nv">to</span><span class="si">}</span><span class="s2">: %{http_code}\n&quot;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">done</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">done</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>sleep.foo<span class="w"> </span>to<span class="w"> </span>service-a.foo:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>sleep.foo<span class="w"> </span>to<span class="w"> </span>service-a.bar:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>sleep.foo<span class="w"> </span>to<span class="w"> </span>service-a.legacy:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>sleep.bar<span class="w"> </span>to<span class="w"> </span>service-a.foo:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>sleep.bar<span class="w"> </span>to<span class="w"> </span>service-a.bar:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>sleep.bar<span class="w"> </span>to<span class="w"> </span>service-a.legacy:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>sleep.legacy<span class="w"> </span>to<span class="w"> </span>service-a.foo:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>sleep.legacy<span class="w"> </span>to<span class="w"> </span>service-a.bar:<span class="w"> </span><span class="m">200</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>sleep.legacy<span class="w"> </span>to<span class="w"> </span>service-a.legacy:<span class="w"> </span><span class="m">200</span>
</span></code></pre></div></p>
<h4 id="362">3.6.2、宽容模式测试</h4>
<p>具有代理的工作负载之间的所有流量都使用双向 TLS，而无需您执行任何操作。</p>
<p>当服务器没有 sidecar 时，header中就没有X-Forwarded-Client-Cert，这意味着请求是纯文本。</p>
<details class="执行结果">
<summary>执行结果</summary>
<div class="language-text highlight"><pre><span></span><code>sidecar -&gt; sidecar
```shell
{&quot;host&quot;:&quot;service-a.foo:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;,&quot;x-forwarded-proto&quot;:&quot;http&quot;,&quot;x-request-id&quot;:&quot;aeb4d7ae-e49d-4ff1-98a7-dfaaccf40566&quot;,&quot;x-envoy-attempt-count&quot;:&quot;1&quot;,&quot;x-forwarded-client-cert&quot;:&quot;By=spiffe://cluster.local/ns/foo/sa/default;Hash=f5e88b5f6633eab21fa2f7a392f6dfdd63f3cdf6c46a99332b0fe1c90e3eb5d9;Subject=\&quot;\&quot;;URI=spiffe://cluster.local/ns/foo/sa/sleep&quot;}
sleep.foo to service-a.foo: 200
```

sidecar -&gt; non-sidecar
```shell
{&quot;host&quot;:&quot;service-a.legacy:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;,&quot;x-forwarded-proto&quot;:&quot;http&quot;,&quot;x-request-id&quot;:&quot;0b09707d-c862-47d4-ae87-a9fc97d17f99&quot;,&quot;x-envoy-decorator-operation&quot;:&quot;service-a.legacy.svc.cluster.local:8000/*&quot;,&quot;x-envoy-peer-metadata-id&quot;:&quot;sidecar~10.1.4.122~sleep-5577c64d7c-ptnp6.foo~foo.svc.cluster.local&quot;,&quot;x-envoy-peer-metadata&quot;:&quot;ChoKCkNMVVNURVJfSUQSDBoKS3ViZXJuZXRlcwp5CgZMQUJFTFMSbyptCg4KA2FwcBIHGgVzbGVlcAoqCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgcaBXNsZWVwCi8KI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEggaBmxhdGVzdAogCgROQU1FEhgaFnNsZWVwLTU1NzdjNjRkN2MtcHRucDYKEgoJTkFNRVNQQUNFEgUaA2ZvbwpFCgVPV05FUhI8GjprdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvZm9vL2RlcGxveW1lbnRzL3NsZWVwChgKDVdPUktMT0FEX05BTUUSBxoFc2xlZXA=&quot;,&quot;x-envoy-attempt-count&quot;:&quot;1&quot;}
sleep.foo to service-a.legacy: 200
```

non-sidecar -&gt; sidecar
```shell
{&quot;host&quot;:&quot;service-a.bar:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;,&quot;x-forwarded-proto&quot;:&quot;http&quot;,&quot;x-request-id&quot;:&quot;fdd4ef65-c566-4361-9dc5-5fd4c42970bc&quot;}
sleep.legacy to service-a.bar: 200
```

non-sidecar -&gt; non-sidecar
```shell
{&quot;host&quot;:&quot;service-a.legacy:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;}
sleep.legacy to service-a.legacy: 200
```
</code></pre></div>
</details>
<h4 id="363">3.6.3、严格模式测试</h4>
<p>为了防止整个mesh的非互TLS流量，可以配置全mesh的对端认证策略，互TLS模式设置为STRICT。网状范围的对等身份验证策略不应该有选择器，并且必须在 <mark>根命名空间</mark> 中应用。
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="s">apiVersion: security.istio.io/v1</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="s">kind: PeerAuthentication</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="s">metadata:</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="s">  name: &quot;default&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="s">  namespace: &quot;istio-system&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="s">spec:</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="s">  mtls:</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="s">    mode: STRICT</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="s">EOF</span>
</span></code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>该示例假设istio-system是根命名空间。如果您在安装过程中使用了不同的值，请将其替换istio-system为您使用的值。</p>
</div>
<details class="结果">
<summary>结果</summary>
<div class="language-text highlight"><pre><span></span><code>sidecar -&gt; sidecar
```shell
{&quot;host&quot;:&quot;service-a.foo:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;,&quot;x-forwarded-proto&quot;:&quot;http&quot;,&quot;x-request-id&quot;:&quot;2c05f546-2a3a-4894-96f9-d0613a6a15dd&quot;,&quot;x-envoy-attempt-count&quot;:&quot;1&quot;,&quot;x-forwarded-client-cert&quot;:&quot;By=spiffe://cluster.local/ns/foo/sa/default;Hash=f5e88b5f6633eab21fa2f7a392f6dfdd63f3cdf6c46a99332b0fe1c90e3eb5d9;Subject=\&quot;\&quot;;URI=spiffe://cluster.local/ns/foo/sa/sleep&quot;}
sleep.foo to service-a.foo: 200
```

sidecar -&gt; non-sidecar
```shell
{&quot;host&quot;:&quot;service-a.legacy:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;,&quot;x-forwarded-proto&quot;:&quot;http&quot;,&quot;x-request-id&quot;:&quot;117b6d2a-ad57-46a0-9a1d-2abc5936f1d7&quot;,&quot;x-envoy-decorator-operation&quot;:&quot;service-a.legacy.svc.cluster.local:8000/*&quot;,&quot;x-envoy-peer-metadata-id&quot;:&quot;sidecar~10.1.4.121~sleep-5577c64d7c-pxqmk.bar~bar.svc.cluster.local&quot;,&quot;x-envoy-peer-metadata&quot;:&quot;ChoKCkNMVVNURVJfSUQSDBoKS3ViZXJuZXRlcwp5CgZMQUJFTFMSbyptCg4KA2FwcBIHGgVzbGVlcAoqCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgcaBXNsZWVwCi8KI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEggaBmxhdGVzdAogCgROQU1FEhgaFnNsZWVwLTU1NzdjNjRkN2MtcHhxbWsKEgoJTkFNRVNQQUNFEgUaA2JhcgpFCgVPV05FUhI8GjprdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFyL2RlcGxveW1lbnRzL3NsZWVwChgKDVdPUktMT0FEX05BTUUSBxoFc2xlZXA=&quot;,&quot;x-envoy-attempt-count&quot;:&quot;1&quot;}
sleep.bar to service-a.legacy: 200
```

non-sidecar -&gt; sidecar
```shell
sleep.legacy to service-a.foo: 000
command terminated with exit code 56
```
non-sidecar -&gt; non-sidecar
```shell
{&quot;host&quot;:&quot;service-a.legacy:8000&quot;,&quot;user-agent&quot;:&quot;curl/8.10.1&quot;,&quot;accept&quot;:&quot;*/*&quot;}
sleep.legacy to service-a.legacy: 200
```
</code></pre></div>
</details>
<h4 id="364">3.6.4、策略优先级</h4>
<p>特定于工作负载的对等身份验证策略优先于命名空间范围的策略。</p>
<h3 id="37">3.7、请求身份验证测试</h3>
<h4 id="371">3.7.1、配置策略</h4>
<p>基于已有的ingressgateway和服务。
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="s">apiVersion: security.istio.io/v1</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="s">kind: RequestAuthentication</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="s">metadata:</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="s">  name: &quot;jwt-example&quot;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="s">  namespace: istio-system</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="s">spec:</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="s">  selector:</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="s">    matchLabels:</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="s">      istio: ingressgateway</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="s">  jwtRules:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="s">  - issuer: &quot;testing@secure.istio.io&quot;</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="s">    jwksUri: &quot;https://raw.githubusercontent.com/istio/istio/release-1.24/security/tools/jwt/samples/jwks.json&quot;</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="s">EOF</span>
</span></code></pre></div></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>curl<span class="w"> </span><span class="s2">&quot;service-a.localserver.com/api/v1/testA/get_headers/&quot;</span><span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}\n&quot;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="m">200</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>curl<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer deadbeef&quot;</span><span class="w"> </span><span class="s2">&quot;service-a.localserver.com/api/v1/testA/get_headers/&quot;</span><span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}\n&quot;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="m">401</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>https://raw.githubusercontent.com/istio/istio/release-1.24/security/tools/jwt/samples/demo.jwt<span class="w"> </span>-s<span class="k">)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>curl<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;service-a.localserver.com/api/v1/testA/get_headers/&quot;</span><span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}\n&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="m">200</span>
</span></code></pre></div>
<h4 id="372">3.7.2、官方示例</h4>
<p><a href="https://istio.io/latest/docs/tasks/security/authentication/authn-policy/#require-a-valid-token">需要有效的令牌</a></p>
<p><a href="https://istio.io/latest/docs/tasks/security/authentication/authn-policy/#require-valid-tokens-per-path">要求每个路径都有有效令牌</a></p>

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <br/>
  <div style="text-align: center" >
    <font size="2" color="grey" >本文阅读量&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次</font>
  </div>

<!-- Source file information -->







  
  



<!-- Was this page helpful? -->

  




<!-- Comment system -->

  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->
<script
  src="https://giscus.app/client.js"
  data-repo="JvvYou/jvvyou.github.io"
  data-repo-id="R_kgDOMfCHJg"
  data-category="Announcements"
  data-category-id="DIC_kwDOMfCHJs4ChY4E"
  data-mapping="title"
  data-input-position="top"
  data-reactions-enabled="1"
  data-emit-metadata="1"
  data-theme="light"
  data-lang="zh-CN"
  crossorigin="anonymous"
  async
>
</script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>


<!-- 
<div style="text-align: center" >
  <br/>    
  <p>优雅的赞助一杯绿茶&#128513;</p>
  <img src="/blog/img/person/WechatIMG36353.jpg" alt="觉得有用的老铁们可以微信赞助一杯82年的雪碧呦。" />
  <br/> 
</div>
 -->
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../istio-%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%BD%E8%B8%AA/" class="md-footer__link md-footer__link--prev" aria-label="上一页: istio 分布式追踪">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                istio 分布式追踪
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/JvvYou" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.path", "navigation.top", "navigation.indexes", "navigation.footer", "search.suggest", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>